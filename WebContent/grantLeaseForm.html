<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Grant Lease form</title>
<script type="text/javascript" src="js/jquery-1.7.min.js"></script>
<script type="text/javascript">
	var ItemId = null;
	var UserId = null;
	var ReqUserId = null;
	
	getData = function (){
		ItemId = document.getElementById("itemId").value;
		UserId = document.getElementById("userId").value;
		ReqUserId = document.getElementById("reqUserId").value;
	};
	
	grant = function() {
		alert("inside add function.");
		getData();
		var req3 = {
				table: "store",
				operation: "delete",
				row: {
					itemId: parseInt(ItemId)
				},
				token: 0
		};
		
		var req2 = {
				table: "requests",
				operation: "edits",
				row: {
					itemId: ItemId.toString(),
					userId: ReqUserId.toString()
				},
				token: null
		};
		
		var req1 = {
				table: "leases",
				operation: "add",
				row: {
					reqUserId: ReqUserId,
					itemId: ItemId,
					userId: UserId
				},
				token: null
		};
		
		var req4 = {
				table: "items",
				operation: "editstat",
				row: {
					id: ItemId,
					title: null,
					description: null,
					category: null,
					userId: null,
					leaseValue: 0,
					leaseTerm: null,
					status: "Leased"
				},
				token: null
		};
		
		alert("got data");
		send(req1,req2,req3,req4);
	};
	
	send = function(req1,req2,req3,req4) {
		alert("Inside send function.");
		$.ajax({
			url: '/flsv2/GrantLease',
			type:'get',
			data: {req1: JSON.stringify(req1),
				req2: JSON.stringify(req2),
				req3: JSON.stringify(req3),
				req4: JSON.stringify(req4)},
			contentType:"application/json",
			dataType: "json",
			
			success: function(response) {
				alert("working");
				document.getElementById("Id").value = response.Id;
				document.getElementById("Code").value = response.Code;
				document.getElementById("Message").value = response.Message
			},
			
			error: function() {
				alert("not working");
			}
		});
	};
	
</script>
</head>
<body>
	<h1>GRANT LEASE FORM</h1>
	<form>
		Request User Id : <input type="text" name="reqUserId" id="reqUserId"><br/><br/>
		Item Id : <input type="text" name="itemId" id="itemId"><br/><br/>
		User Id : <input type="text" name="userId" id="userId"><br/><br/>
		<input type="button" value="Grant Lease" onclick="grant()"><br/><br/>
		<h1>OUTPUT</h1>
		ID : <input type="text" name="Id" id="Id"><br/><br/>
		Code : <input type="text" name="code" id="Code"><br/><br/>
		Message : <input type="text" name="message" id="Message"><br/><br/>
	</form>
	<br/>
	<h3><A href="index.html">INDEX</A></h3>
</body>
</html>