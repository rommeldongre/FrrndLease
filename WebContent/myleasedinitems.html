
		<div class="container-fluid" id="midcontainer" ng-cloak>
			<div id="heading"><strong>My Leased In Items</strong></div>
			
			<table id="leasetable" class="table table-striped">
				<thead>
					<tr>
						<th class="tablecell" style="text-align:left;">Date</th>
						<th class="tablecell" style="text-align:center;">Item</th>
						<th class="tablecell" style="text-align:center;">ReqUserId</th>
						<th class="tablecell" style="text-align:center;">Action</th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="lease in leases">
                        <td style="width:15%;text-align:left;" class="tablecell">{{lease.expiry}}</td>
                        <td style="width:40%;text-align:center;" id="{{lease.itemId}}" class="tablecellItem">{{lease.itemTitle}}</td>
                        <td style="width:25%;text-align:center;" id="{{lease.itemId}}" class="tablecellFriend">{{lease.ownerName}}</td>
                        <td style="width:20%;text-align:center;" class="tablecellAction">
                            <span class="remove">
                                <span class="btn btn-primary" style="margin-top: 5px;margin-left: 10px;" id="{{lease.itemNextId}}">Request Cancel</span>
                            </span>
                            <span class="renew">
                                <span class="btn btn-primary" style="margin-top: 5px;margin-left: 10px;" id="{{lease.itemNextId}}">Request Renew</span>
                            </span>
                        </td>
                    </tr>
				</tbody>
			</table>
			
            <h4 ng-if="hasItems">You have not leased any items from your friends. 
                <a href="index.html">See what they have in the Friends Store.</a>
            </h4>
		</div>
	
	
	<script type="text/javascript">
		var userloggedin, leaseExpiry, leaseItemId, leaseReqUser, leaseReqOwnerName,objUserId;
		
		function lease_read(){
			
			reasonForGetLeaseItem = 'showLeaseTable';
			
			getLeaseItem(itemNextId);
			
		}
        
        function getLeaseItem(i){
            itemToken = i;
            itemToken = itemToken.toString();
            var req = {
                operation: "getNextActive",
                token: itemToken
            }
            getLeaseItemSend(req);
        }

        function getLeaseItemSend(req){

            $.ajax({
                url: '/flsv2/GetLeases',
                type:'get',
                data: {req: JSON.stringify(req)},
                contentType:"application/json",
                dataType: "json",

                success: function(response) {

                    if(response.Code == "FLS_SUCCESS") {
                        //alert(response.Id+" "+response.Code);
                        obj = JSON.parse(response.Message);

                        itemNextId = response.Id;

                        //alert('reqUserId:'+obj.reqUserId+" itemId:"+obj.itemId+" userId:"+obj.userId+" expiry:"+obj.expiry);
                        //alert(reasonForGetRequestItem);

                        if(reasonForGetLeaseItem == 'showLeaseTable')	
                            showLeaseItem(obj);		//function is in the myleasedoutitems.html and myleasedinitems.html
                        else if(reasonForGetLeaseItem == 'renewLease'){
                            renew_Lease(obj);		//function is in the myleasedoutitems.html
                        }else if(reasonForGetLeaseItem == 'justGetLeaseItem'){
                            setLeaseItemId(obj);
                        }else if(reasonForGetLeaseItem == 'closeLease'){
                            close_Lease(obj);
                        }

                    }
                    else{
                        //confirmationIndex(response.Message);
                        if(itemNextId == 0){
                            showEmptyText();		//function is in the myleasedoutitems.html and myleasedinitems.html
                        }
                    }
                },

                error: function() {
                    var msg = "Not Working";
                    confirmationIndex(msg);
                }
            });
        }
		
		function showLeaseItem(obj){
			reasonForSearchItem = "getLeasedItemInfo";
			leaseExpiry = obj.expiry; 
			leaseItemId = obj.itemId; 
			leaseReqUser = obj.reqUserId;
			objUserId = obj.userId;
			leaseReqOwnerName= obj.OwnerFullName;
			
			leaseItemId--;
			
			searchItemSetValues(leaseItemId, '', '', '', 0, '');
			searchItemDbCreate();
		}
        
        function searchItemSetValues(id, title, description, category, leasevalue, leaseterm){
            itemId = id;
            if(itemId == null || itemId == '' || itemId == 'null')
                itemId = 0;

            itemTitle = title;
            if (itemTitle === '') 
                itemTitle = "";

            itemDescription = description;
            if (itemDescription === '') 
                itemDescription = "";

            itemCategory = category;
            if (itemCategory === '') 
                itemCategory = "";

            itemLeaseValue = leasevalue;
            if (itemLeaseValue === '') 
                itemLeaseValue = 0;

            itemLeaseTerm = leaseterm;
            if (itemLeaseTerm === '') 
                itemLeaseTerm = "";
        }

        function searchItemDbCreate(){	
            var req = {
                token: itemId,
                title: itemTitle,
                description: itemDescription,
                category: itemCategory,
                leaseValue: itemLeaseValue,
                leaseTerm: itemLeaseTerm
            };

            searchItemSend(req);
        }

        function searchItemSend(req){

            $.ajax({
                url: '/flsv2/SearchItem',
                type: 'post',
                data: {req : JSON.stringify(req)},
                contentType: "application/x-www-form-urlencoded",
                dataType: "json",

                success: function(response) {	
                    if(response.Code == "FLS_SUCCESS") {
                        itemObj = JSON.parse(response.Message);

                        if(reasonForSearchItem == "getLeasedItemInfo"){
                            showLeaseItemContinued(itemObj);

                        }else{
                            itemId = itemObj.itemId;
                            addItemToCarousel(itemObj);
                        }	
                    }
                },

                error: function() {
                    alert('Not Working');
                }
            });
        }
		
		function showLeaseItemContinued(obj){
			userloggedin = localStorage.getItem("userloggedin");
			
			if(leaseReqUser == userloggedin){
				var table = document.getElementById("leasetable");
				var row = table.insertRow(1);
				var cell0 = row.insertCell(0);
				var cell1 = row.insertCell(1);
				var cell2 = row.insertCell(2);
				var cell3 = row.insertCell(3);
				
				cell0.setAttribute("style", "width:15%;");
				cell1.setAttribute("style", "width:40%;");
				cell2.setAttribute("style", "width:25%;");
				cell3.setAttribute("style", "width:20%;");
				
				var span1 = document.createElement("span");
				var span2 = document.createElement("span");
				var span3 = document.createElement("span");
				var span4 = document.createElement("span");
				
				span1.className = "remove";
				span2.className = "renew";
			
				span3.innerHTML="Remove";
				span4.innerHTML="Repeat";
				
				span3.id = itemNextId;
				span4.id = itemNextId;
				
				span1.appendChild(span3);
				span2.appendChild(span4);
				
				
				cell0.innerHTML = leaseExpiry;
				cell1.innerHTML = obj.title;	
				
				cell2.innerHTML = leaseReqOwnerName;		
				
				cell3.appendChild(span1);
				cell3.appendChild(span2);
				
				
				//cell0.id = "date";			//commented because, not using this id anywhere
				cell1.id = obj.itemId;
				cell2.id = obj.itemId;
			
			}
			
			lease_read();
			
		}
		
		function showEmptyText(){
			var h4 = document.getElementById("emptyText");
			h4.innerHTML = "";
			var a = document.createElement("a");
			a.href = "index.html";
			a.innerHTML = "";
			h4.appendChild(a);
		}
		
	</script>